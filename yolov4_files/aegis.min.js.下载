/**
 *  =====================================================================
 * @tencent/aegis-web-sdk@1.34.49 (c) 2021 Tencent Application Monitor.
 * Author pumpkincai.
 * Last Release Time Fri Aug 13 2021 15:51:40 GMT+0800 (GMT+08:00).
 * Released under the MIT License.
 * Thanks for supporting TAM & Aegis!
 * =====================================================================
 **/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Aegis=t()}(this,function(){"use strict";var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},E=function(){return(E=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function t(e,s,a,u){return new(a=a||Promise)(function(n,t){function o(e){try{r(u.next(e))}catch(e){t(e)}}function i(e){try{r(u.throw(e))}catch(e){t(e)}}function r(e){var t;e.done?n(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(o,i)}r((u=u.apply(e,s||[])).next())})}function d(n,o){var i,r,s,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,r&&(s=2&t[0]?r.return:t[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,t[1])).done)return s;switch(r=0,(t=s?[2&t[0],s.value]:t)[0]){case 0:case 1:s=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,r=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!((s=0<(s=a.trys).length&&s[s.length-1])||6!==t[0]&&2!==t[0])){a=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3])){a.label=t[1];break}if(6===t[0]&&a.label<s[1]){a.label=s[1],s=t;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(t);break}s[2]&&a.ops.pop(),a.trys.pop();continue}t=o.call(n,a)}catch(e){t=[6,e],r=0}finally{i=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}}function o(t){try{return encodeURIComponent(decodeURIComponent(t))}catch(e){return t}}var m,g=(e.prototype.indexOf=function(e,t){for(var n=0;n<e.length;n++)if(e[n].callback===t)return n;return-1},e.prototype.on=function(e,t,n){if(void 0===n&&(n=0),this){var o=this.eventsList[e];return(o||(this.eventsList[e]=[],o=this.eventsList[e]),-1!==this.indexOf(o,t))?this:(o.push({name:e,type:n||0,callback:t}),this)}},e.prototype.one=function(e,t){this.on(e,t,1)},e.prototype.remove=function(e,t){if(this){var n=this.eventsList[e];if(!n)return null;if(t)return n.length&&(t=this.indexOf(n,t),n.splice(t,1)),this;try{delete this.eventsList[e]}catch(e){}return null}},e.prototype.clear=function(){this.eventsList={}},e),O=function(e){return(e=Array.isArray(e)?e:[e]).map(function(t,n){return Object.getOwnPropertyNames(t).map(function(e){return o(e)+"["+n+"]="+(void 0===t[e]?"":o(t[e]))}).join("&")}).join("&")+(e.length?"&count="+e.length:"")};function e(){var s=this;this.emit=function(e,t){if(s){var n;if(null!=(o=s.eventsList[e])&&o.length)for(var o=o.slice(),i=0;i<o.length;i++){n=o[i];try{var r=n.callback.apply(s,[t]);if(1===n.type&&s.remove(e,n.callback),!1===r)break}catch(e){throw e}}return s}},this.eventsList={}}(M=m=m||{})[M.number=-1]="number",M.string="";function i(e,t){return"number"==typeof e||"string"==typeof e?e:t?m.string:m.number}function y(e,t){return"string"==typeof e?e.split("?")[t?1:0]||"":e}function w(e){return"string"==typeof e&&e.startsWith("//")?"undefined"!=typeof location&&"https:"===location.protocol:/^https/.test(e)}function v(){return void 0!==window.performance&&"function"==typeof performance.clearResourceTimings&&"function"==typeof performance.getEntriesByType&&"function"==typeof performance.now}function r(t){return s.some(function(e){return-1!==t.indexOf(e)})}function b(e,t){var n;try{"string"==typeof e&&(e=JSON.parse(e)),"function"==typeof(null===(n=null==t?void 0:t.ret)||void 0===n?void 0:n.join)&&(a=[].concat(t.ret.map(function(e){return e.toLowerCase()})));var o=Object.getOwnPropertyNames(e).filter(function(e){return-1!==a.indexOf(e.toLowerCase())});return o.length?""+e[o[0]]:"unknown"}catch(e){return"unknown"}}function R(r,s){void 0===s&&(s=3);var i,a,u,c="";return Array.isArray(r)?(c+="[",i=r.length,r.forEach(function(e,t){var n,o;c+="object"==typeof e&&1<s?R(e,s-1):(o="",o+="undefined"==(e=typeof(n=e))||"symbol"==e||"function"==e?"null":"string"==e||"object"==e?'"'+n+'"':n),c+=t===i-1?"":","}),c+="]"):r instanceof Object?(c="{",a=Object.keys(r),u=a.length,a.forEach(function(e,t){var n,o,i;"object"==typeof r[e]&&1<s?c+='"'+e+'":'+R(r[e],s-1):c+=(o=r[n=e],i="","string"==(e=typeof o)||"object"==e?i+='"'+n+'":"'+o+'"':"function"==typeof o?i+='"'+n+'":"function '+o.name+'"':"symbol"==typeof o?i+='"'+n+'":"symbol"':"number"!=typeof o&&"boolean"!=e||(i+='"'+n+'": '+o),i),c+=t===u-1||t<u-1&&void 0===r[a[t+1]]?"":","}),c+="}"):c+=r,c}var T,L,s=["application/octet-stream","application/xhtml+xml","application/xml","application/pdf","application/pkcs12","application/javascript","application/ecmascript","application/vnd.mspowerpoint","application/ogg","text/html","text/css","text/javascript","image","audio","video"],a=["ret","retcode","code"],x=function(e){if("string"==typeof e)return e;try{return(JSON.stringify(e,(o=[],i=[],function(e,t){if(t instanceof Error)return"Error.message: "+t.message+" \n  Error.stack: "+t.stack;if("object"==typeof t&&null!==t){var n=o.indexOf(t);if(-1!==n)return"[Circular "+i[n]+"]";o.push(t),i.push(e||"root")}return t}),4)||"undefined").replace(/"/gim,"")}catch(e){return"error happen when aegis stringify: \n "+e.message+" \n "+e.stack}var o,i},S=(c.prototype.sourceURL=function(){return this.data.responseURL},c.prototype.status=function(){return Number(this.data.status)},c.prototype.headers=function(){var e=this.data.getAllResponseHeaders().split("\n"),n={};return e.forEach(function(e){var t;e&&(e=(t=e.split(": "))[0],t=t[1].trim(),n[e]=t)}),n},c),p=(u.prototype.sourceURL=function(){return this.data.url},u.prototype.status=function(){return Number(this.data.status)},u.prototype.headers=function(){var n={};return this.data.headers.forEach(function(e,t){n[t]=e}),n},u);function u(e,t){this.type="fetch",this.data=e||{},this.data.response=t}function c(e){this.type="xhr",this.data=e}(G=T=T||{}).INFO_ALL="-1",G.API_RESPONSE="1",G.INFO="2",G.ERROR="4",G.PROMISE_ERROR="8",G.AJAX_ERROR="16",G.SCRIPT_ERROR="32",G.IMAGE_ERROR="64",G.CSS_ERROR="128",G.CONSOLE_ERROR="256",G.MEDIA_ERROR="512",G.RET_ERROR="1024",G.REPORT="2048",G.PV="4096",G.EVENT="8192",(Pe=Le=Le||{})[Pe.android=1]="android",Pe[Pe.ios=2]="ios",Pe[Pe.windows=3]="windows",Pe[Pe.macos=4]="macos",Pe[Pe.linux=5]="linux",Pe[Pe.devtools=6]="devtools",Pe[Pe.other=100]="other",(de=ce=ce||{})[de.unknown=100]="unknown",de[de.wifi=1]="wifi",de[de.net2g=2]="net2g",de[de.net3g=3]="net3g",de[de.net4g=4]="net4g",de[de.net5g=5]="net5g",de[de.net6g=6]="net6g",(he=L=L||{}).LOG="log",he.SPEED="speed",he.PERFORMANCE="performance",he.OFFLINE="offline",he.WHITE_LIST="whiteList",he.VITALS="vitals",he.PV="pv",he.CUSTOM_PV="customPV",he.EVENT="event",he.CUSTOM="custom",he.SDK_ERROR="sdkError";function C(e,n){var o,i=[],r=e.config;return e.lifeCycle.on("destroy",function(){i.length=0}),function(e,t){if(i.push(e),n&&i.length>=n)return i=k(i),t(i.splice(0,i.length)),void(o&&clearTimeout(o));o&&clearTimeout(o),o=setTimeout(function(){o=null,0<(i=k(i)).length&&t(i.splice(0,i.length))},r.delay)}}function P(e,t){return Array.isArray(e)?t(e.map(function(e){return E(E({},e),{msg:"string"==typeof e.msg?e.msg:[].concat(e.msg).map(x).join(" ")})})):t(E(E({},e),{msg:"string"==typeof e.msg?e.msg:x(e.msg)}))}function I(n){if(!n||!n.reduce||!n.length)throw new TypeError("createPipeline need at least one function param");return 1===n.length?function(e,t){n[0](e,t||U)}:n.reduce(function(n,o){return function(e,t){return void 0===t&&(t=U),n(e,function(e){return null==o?void 0:o(e,t)})}})}function l(t,n){Object.getOwnPropertyNames(t).forEach(function(e){"function"==typeof t[e]&&"constructor"!==e&&(n?n[e]=function(){}:t[e]=function(){})})}function f(t){if(X.find(function(e){return e.name===t.name}))throw new Error("name '"+t.name+"' is already in hackXHR option list");var n,o;X.push(t),!B&&window.XMLHttpRequest&&(B=!0,n=window.XMLHttpRequest.prototype.send,o=window.XMLHttpRequest.prototype.open,window.XMLHttpRequest.prototype.open=function(){if(this.aegisMethod=arguments[0],this.aegisUrl=arguments[1],this.aegisXhrStartTime=Date.now(),!this.sendByAegis)for(var e=0;e<X.length;e++){var t=X[e];try{"function"==typeof t.open&&t.open(this)}catch(e){}}return o.apply(this,arguments)},window.XMLHttpRequest.prototype.send=function(){if(!this.sendByAegis)for(var e=0;e<X.length;e++){var t=X[e];try{"function"==typeof t.send&&t.send(this,arguments[0])}catch(e){}}return n.apply(this,arguments)})}function h(t){var e=X.findIndex(function(e){return e.name===t.name});-1!==e&&X.splice(e,1)}var A,N,k=function(e){return e.filter(function(n,o){return"static"!==n.type||!e.find(function(e,t){return o!==t&&n.url===e.url&&200===n.status})})},_=function(e){e.level===T.INFO_ALL&&(e.level=T.INFO)},j=function(o){return function(e,n){return o.send({url:o.config.url||"",data:O(e),method:"post",contentType:"application/x-www-form-urlencoded",type:L.LOG,log:e},function(){var t=o.config.onReport;"function"==typeof t&&e.forEach(function(e){t(e)}),"function"==typeof n&&n([])},function(e){"403 forbidden"===e&&o.destroy()})}},U=function(){},F=($.prototype.init=function(e){this.setConfig(e);for(var t=0;t<$.installedPlugins.length;t++)try{$.installedPlugins[t].patch(this)}catch(e){this.sendSDKError(e)}this.lifeCycle.emit("onInited")},$.prototype.setConfig=function(e){Object.assign(this.config,e);var t=this.config,n=t.id,o=t.uin,i=t.version,r=t.ext1,s=t.ext2,a=t.ext3,e=t.aid,t=this.bean.id!==n||this.bean.uin!==o||this.bean.aid!==e;return this.bean.id=n||"",this.bean.uin=o||"",this.bean.version=i||"1.34.49",this.bean.aid=e||"",r&&(this.bean.ext1=r),s&&(this.bean.ext2=s),a&&(this.bean.ext3=a),t&&this.lifeCycle.emit("onConfigChange",this.config),this.config},$.use=function(e){-1===$.installedPlugins.indexOf(e)&&e.aegisPlugin&&$.installedPlugins.push(e)},$.unuse=function(e){e=$.installedPlugins.indexOf(e);-1!==e&&$.installedPlugins.splice(e,1)},$.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n={level:T.INFO,msg:e};1===e.length&&e[0].msg&&Object.assign(n,E({},e[0]),{level:T.INFO}),this.normalLogPipeline(n)},$.prototype.infoAll=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n={level:T.INFO_ALL,msg:e};1===e.length&&e[0].msg&&Object.assign(n,E({},e[0]),{level:T.INFO_ALL}),this.normalLogPipeline(n)},$.prototype.report=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n={level:T.REPORT,msg:e};1===e.length&&e[0].msg&&Object.assign(n,E({},e[0])),this.normalLogPipeline(n)},$.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n={level:T.ERROR,msg:e};1===e.length&&e[0].msg&&Object.assign(n,E({},e[0]),{level:T.ERROR}),this.normalLogPipeline(n)},$.prototype.speedLogPipeline=function(e){throw new Error('You need to override "speedLogPipeline" method')},$.prototype.reportPv=function(e){var t,n=this;e&&(console.warn("reportPv is deprecated, please use reportEvent"),t=""+Object.getOwnPropertyNames(this.bean).filter(function(e){return"id"!==e}).map(function(e){return e+"="+n.bean[e]}).join("&"),this.send({url:this.config.url+"/"+e+"?"+t,addBean:!1,type:L.CUSTOM_PV},function(){},function(e){"403 forbidden"===e&&n.destroy()}))},$.prototype.reportEvent=function(e){e&&((e="string"==typeof e?{name:e,ext1:this.config.ext1||"",ext2:this.config.ext2||"",ext3:this.config.ext3||""}:e).name?this.eventPipeline(e):console.warn("reportEvent params error"))},$.prototype.reportTime=function(e,t){if("object"==typeof e)return this.reportT(e);"string"==typeof e?"number"==typeof t?t<0||6e4<t?console.warn("reportTime: duration must between 0 and 60000"):this.submitCustomTime(e,t):console.warn("reportTime: second param must be number"):console.warn("reportTime: first param must be a string")},$.prototype.reportT=function(e){var t=e.name,n=e.duration,o=e.ext1,i=void 0===o?"":o,r=e.ext2,o=void 0===r?"":r,r=e.ext3,r=void 0===r?"":r,e=e.from;if("string"==typeof t&&"number"==typeof n&&"string"==typeof i&&"string"==typeof o&&"string"==typeof r){if(!(n<0||6e4<n))return this.submitCustomTime(t,n,i,o,r,void 0===e?"":e);console.warn("reportTime: duration must between 0 and 60000")}else console.warn("reportTime: params error")},$.prototype.time=function(e){"string"==typeof e?this.timeMap[e]?console.warn("Timer "+e+" already exists"):this.timeMap[e]=Date.now():console.warn("time: first param must be a string")},$.prototype.timeEnd=function(e){"string"==typeof e?this.timeMap[e]?(this.submitCustomTime(e,Date.now()-this.timeMap[e]),delete this.timeMap[e]):console.warn("Timer "+e+" does not exist"):console.warn("timeEnd: first param must be a string")},$.prototype.submitCustomTime=function(e,t,n,o,i,r){this.customTimePipeline({name:e,duration:t,ext1:n||this.config.ext1,ext2:o||this.config.ext2,ext3:i||this.config.ext3,from:r||void 0})},$.prototype.extendBean=function(e,t){this.bean[e]=t},$.prototype.send=function(c,l,f){var e=this;return new Promise(function(s,a){var i,r,u;I([(i=e,r=c.type,function(n,o){return t(void 0,void 0,void 0,function(){var t;return d(this,function(e){return n?(n=Array.isArray(n)?n:[n],i.lifeCycle.emit("beforeRequest",n),(n="function"==typeof(t=i.config.beforeRequest)?n.filter(function(e){return!1!==t(e,r)}):n).length&&o(n),[2]):[2,o(n)]})})}),function(i,r){return new Promise(function(n,o){e.request(c,function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];r({isErr:!1,result:e,logType:c.type,logs:i}),null==l||l.apply(void 0,e),n.apply(void 0,e),s.apply(void 0,e)},function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];r({isErr:!0,result:e,logType:c.type,logs:i}),null==f||f(e),o(e),a(e)})})},(u=e,function(n,o){return t(void 0,void 0,void 0,function(){var t;return d(this,function(e){return u.lifeCycle.emit("afterRequest",n),"function"==typeof(t=u.config.afterRequest)&&!1===t(n)||o(n),[2]})})})])(c.log)})},$.prototype.request=function(e,t,n){throw new Error('You need to override "request" method')},$.prototype.sendSDKError=function(e){this.send({url:this.config.url+"?id=1085&msg[0]="+encodeURIComponent(x(e))+"&level[0]=2&from="+this.config.id+"&count=1&version="+this.config.id+"(1.34.49)",addBean:!1,method:"get",type:L.SDK_ERROR})},$.prototype.destroy=function(e){void 0===e&&(e=!1);var t,n,o=$.instances.indexOf(this);-1!==o&&$.instances.splice(o,1);for(var i=$.installedPlugins.length-1;0<=i;i--)try{var r=$.installedPlugins[i];r.unpatch(this),0===r.countInstance()&&(r.uninstall(),$.unuse(r),r=null)}catch(e){this.sendSDKError(e)}if(this.lifeCycle.emit("destroy"),this.lifeCycle.clear(),e)t=this,n=Object.getOwnPropertyDescriptors(t),Object.keys(n).forEach(function(e){n[e].writable&&(t[e]=null)}),Object.setPrototypeOf(this,null);else{for(var s=this;s.constructor!==Object&&l(s,this),s=Object.getPrototypeOf(s););0===$.instances.length&&(e=Object.getPrototypeOf(this).constructor,l(e),l($))}},$.instances=[],$.LOG_TYPE=T,$.installedPlugins=[],$),q=(J.prototype.patch=function(e){this.canUse(e)&&this.exist(e)&&(this.instances.push(e),this.triggerInit(e),this.triggerOnNewAegis(e))},J.prototype.unpatch=function(e){e=this.instances.indexOf(e);-1!==e&&this.instances.splice(e,1)},J.prototype.countInstance=function(){return this.instances.length},J.prototype.uninstall=function(){var e;null===(e=null===(e=this.option)||void 0===e?void 0:e.destroy)||void 0===e||e.apply(this)},J.prototype.walk=function(n){var o=this;this.instances.forEach(function(e){var t=o.canUse(e);t&&n(e,t)})},J.prototype.canUse=function(e){e=this.getConfig(e);return!(!e||"object"!=typeof e)||!!e},J.prototype.getConfig=function(e){return null===(e=e.config)||void 0===e?void 0:e[this.name]},J.prototype.exist=function(e){return-1===this.instances.indexOf(e)},J.prototype.triggerInit=function(e){var t;this.inited||(this.inited=!0,null===(t=null===(t=this.option)||void 0===t?void 0:t.init)||void 0===t||t.call(this.option,this.getConfig(e)))},J.prototype.triggerOnNewAegis=function(e){var t;null===(t=null===(t=this.option)||void 0===t?void 0:t.onNewAegis)||void 0===t||t.call(this.option,e,this.getConfig(e))},J),H=new q({name:"aid",aid:"",init:function(e){try{var t=!0!==e&&e||window.localStorage.getItem("AEGIS_ID");t||(t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}),window.localStorage.setItem("AEGIS_ID",t)),this.aid=t}catch(e){}},onNewAegis:function(e){e.bean.aid=this.aid,e.config.aid=this.aid}}),D=new q({name:"reportAssetSpeed"}),M=D=new q({name:"reportAssetSpeed",collectCur:0,ASSETS_INITIATOR_TYPE:["img","css","script","link","audio","video"],onNewAegis:function(e){var t=this;v()&&(this.collectSuccLog(e),this.collectFailLog(e),performance.onresourcetimingbufferfull=function(){t.collectCur=0,performance.clearResourceTimings()})},publish:function(t){this.$walk(function(e){e.speedLogPipeline(t)})},collectSuccLog:function(e){function n(e){for(var t=0,n=e.length;t<n;t++){var o=e[t];-1!==i.ASSETS_INITIATOR_TYPE.indexOf(o.initiatorType)&&-1===o.name.indexOf("cdn-go.cn/aegis/aegis-sdk")&&i.publish(i.generateLog(o,r))}}var t,o,i=this,r=e.config;"function"==typeof window.PerformanceObserver?(n(performance.getEntriesByType("resource")),(t=new window.PerformanceObserver(function(e){n(e.getEntries())})).observe({entryTypes:["resource"]}),e.lifeCycle.on("destroy",function(){0===D.countInstance()&&t.disconnect()})):(o=setInterval(function(){var e=performance.getEntriesByType("resource"),t=e.slice(i.collectCur);i.collectCur=e.length,n(t)},3e3),e.lifeCycle.on("destroy",function(){0===D.countInstance()&&clearInterval(o)}))},collectFailLog:function(e){function t(e){var t,n;e&&(e=e.target||e.srcElement,t=(null==e?void 0:e.src)||(null==e?void 0:e.href),e=null==e?void 0:e.tagName,t&&"string"==typeof t&&("IMG"===e&&-1<window.location.href.indexOf(t)||(e="function"==typeof(null===(e=i.api)||void 0===e?void 0:e.resourceTypeHandler)?null===(n=i.api)||void 0===n?void 0:n.resourceTypeHandler(t):"",n=performance.getEntriesByType("resource").find(function(e){return e.name===t}),e={url:y(t),status:400,duration:Number(((null==n?void 0:n.duration)||0).toFixed(2)),method:"get",type:e||"static",isHttps:w(t),urlQuery:y(t,!0),domainLookup:0,connectTime:0},o.publish(e))))}var o=this,i=e.config;window.document.addEventListener("error",t,!0),e.lifeCycle.on("destroy",function(){0===D.countInstance()&&window.document.removeEventListener("error",t,!0)})},generateLog:function(e,t){var n,o="function"==typeof(null===(n=t.api)||void 0===n?void 0:n.resourceTypeHandler)?null===(o=t.api)||void 0===o?void 0:o.resourceTypeHandler(e.name):"";return{url:y(e.name),method:"get",duration:Number(e.duration.toFixed(2)),status:200,type:o||"static",isHttps:w(e.name),urlQuery:y(e.name,!0),domainLookup:i(e.domainLookupEnd-e.domainLookupStart),connectTime:i(e.connectEnd-e.connectStart)}},destroy:function(){this.option.publish=function(){}}}),B=!1,X=[],W=!1,V=[],G=(new q({name:"reportApiSpeed"}),new q({name:"reportApiSpeed",override:!1,onNewAegis:function(e){this.override||(this.override=!0,this.overrideFetch(e.config),this.overrideXhr(e.config))},overrideFetch:function(f){var d=this,e={name:this.name,then:function(s,a,u,c){var e,t,n,l={url:s.url,isHttps:w(s.url),method:(null==c?void 0:c.method)||"get",duration:a,type:"fetch",status:s.status};"fetch"!==(n="function"==typeof(null===(e=f.api)||void 0===e?void 0:e.resourceTypeHandler)?null===(t=f.api)||void 0===t?void 0:t.resourceTypeHandler(s.url):n)&&"static"!==n&&(t=s.headers?s.headers.get("content-type"):"",n=s.ok&&"string"==typeof t&&r(t)?"static":"fetch"),"fetch"===n?s.clone().text().then(function(e){var t,n="req url: "+u+" \n                                \nreq method: "+((null==c?void 0:c.method)||"get")+" \n                                \nreq param: "+R(null==c?void 0:c.body)+" \n                                \nres duration: "+a+" \n                                \nres status: "+s.status+" \n                                \nres data: "+e;d.publishNormalLog({msg:n,level:T.API_RESPONSE}),l.payload=new p(s,e);var o,i,r;("function"==typeof(null===(t=f.api)||void 0===t?void 0:t.retCodeHandler)?(r=(i=f.api.retCodeHandler(e,s.url,s)||{}).code,o=i.isErr,l.ret=r,o):(i=b(e,f.api),l.ret=i,e=(e=null===(o=f.api)||void 0===o?void 0:o.errCode)&&[].concat(e),r=(r=null===(o=f.api)||void 0===o?void 0:o.code)&&[].concat(r),e&&-1!==e.indexOf(i)||r&&-1===r.indexOf(i)||!e&&!r&&"0"!==i&&"unknown"!==i))&&d.publishNormalLog({msg:n,level:T.RET_ERROR})}):Object.assign(l,{type:"static",urlQuery:y(s.url,!0),domainLookup:m.number,connectTime:m.number}),d.publishSpeed(l)},catch:function(e,t,n,o){var i={url:n,isHttps:w(n),method:(null==o?void 0:o.method)||"get",duration:t,type:"fetch",status:0};d.publishSpeed(i);o="AJAX_ERROR: "+e+"\n                          \nres status: 0\n                          \nres duration: "+t+"\n                          \nreq url: "+n+"\n                          \nreq method: "+((null==o?void 0:o.method)||"get")+"\n                          \nreq param: "+R(null==o?void 0:o.body);throw d.publishNormalLog({msg:o,level:T.AJAX_ERROR}),e}};this.hackFetchOptions=e,function(t){if(V.find(function(e){return e.name===t.name}))throw new Error("name '"+t.name+"' is already in hackFetch option list");var s;V.push(t),!W&&window.fetch&&(W=!0,s=window.fetch,window.fetch=function(e,o){void 0===o&&(o={});for(var i="string"==typeof e?e:e.url,t=0;t<V.length;t++){var n=V[t];try{"function"==typeof n.beforeFetch&&n.beforeFetch(i,o)}catch(e){}}var r=Date.now();return s(e,o).then(function(e){for(var t=0;t<V.length;t++){var n=V[t];try{"function"==typeof n.then&&n.then(e,Date.now()-r,i,o)}catch(e){}}return e}).catch(function(e){for(var t=0;t<V.length;t++){var n=V[t];try{"function"==typeof n.catch&&n.catch(e,Date.now()-r,i,o)}catch(e){}}throw e})})}(this.hackFetchOptions)},getRequestType:function(e,t,n){var o,i="function"==typeof(null===(o=e.api)||void 0===o?void 0:o.resourceTypeHandler)?null===(i=e.api)||void 0===i?void 0:i.resourceTypeHandler(n):"";return"fetch"!==i&&"static"!==i&&(n=t.getResponseHeader("content-type"),i=400<=t.status||"string"!=typeof n||!r(n)?"fetch":"static"),i},overrideXhr:function(g){var v=this,e={name:this.name,send:function(d,p){var h=Date.now();d.addEventListener("loadend",function(){var e,t,n,o=d.aegisUrl;if(o){var i=Date.now()-h,r={url:o,isHttps:w(o),status:d.status,method:d.aegisMethod||"get",type:"fetch",duration:i,payload:new S(d)};if("fetch"===v.getRequestType(g,d,o))try{var s="req url: "+o+" \n                                \nreq method: "+r.method+" \n                                \nreq param: "+R(p)+" \n                                \nres duration: "+i+" \n                                \nres status: "+r.status+" \n                                \nres data: "+R(d.response);v.publishNormalLog({msg:s,level:T.API_RESPONSE,trace:d.aegisTjgTrace});var a,u,c,l,f;("function"==typeof(null===(e=g.api)||void 0===e?void 0:e.retCodeHandler)?(f=(a=g.api.retCodeHandler(d.response,o,d)||{}).code,u=a.isErr,r.ret=f,u):(c=b(d.response,g.api),r.ret=c,l=(l=null===(t=g.api)||void 0===t?void 0:t.errCode)&&[].concat(l),f=(f=null===(n=g.api)||void 0===n?void 0:n.code)&&[].concat(f),l&&-1!==l.indexOf(c)||f&&-1===f.indexOf(c)||!l&&!f&&"0"!==c&&"unknown"!==c))&&v.publishNormalLog({msg:s,level:T.RET_ERROR})}catch(e){r.ret="unknown"}else Object.assign(r,{type:"static",urlQuery:y(o,!0),domainLookup:m.number,connectTime:m.number});v.publishSpeed(r)}})}};this.hackXHROptions=e,f(this.hackXHROptions)},publishSpeed:function(n){var o=this;n.url=y(n.url),this.$walk(function(e){var t=o.$getConfig(e);"fetch"===n.type&&t&&"function"==typeof t.urlHandler?e.speedLogPipeline(E(E({},n),{url:encodeURIComponent(t.urlHandler(n.url,n.payload))})):e.speedLogPipeline(n)})},publishNormalLog:function(t){this.$walk(function(e){e.normalLogPipeline(t)})},destroy:function(){var t,e;this.option.publishSpeed=function(){},this.option.publishNormalLog=function(){},this.option.hackXHROptions&&h(this.option.hackXHROptions),this.option.hackFetchOptions&&(t=this.option.hackFetchOptions,-1!==(e=V.findIndex(function(e){return e.name===t.name}))&&V.splice(e,1))}}));function J(e){this.aegisPlugin=!0,this.name="",this.instances=[],this.inited=!1,e.$walk=this.walk.bind(this),e.$getConfig=this.getConfig.bind(this),this.option=e,this.name=e.name}function $(e){var n,t,s,o,a,u,i,c,r,l,f,d,p,h=this;this.config={version:0,delay:1e3,onError:!0,repeat:5,random:1,aid:!0,device:!0,pagePerformance:!0,webVitals:!0,speedSample:!0,hostUrl:"https://aegis.qq.com",url:"",offlineUrl:"",whiteListUrl:"",pvUrl:"",speedUrl:"",customTimeUrl:"",performanceUrl:"",webVitalsUrl:"",eventUrl:""},this.isWhiteList=!1,this.lifeCycle=new g,this.bean={},this.normalLogPipeline=I([C(this,5),P,function(e,t){if("number"!=typeof n.config.random&&(console.warn("random must in [0, 1], default is 1."),n.config.random=1),Math.random()<n.config.random)return t(e)},(d=(n=this).config,p={},function(e,t){var n="number"==typeof d.repeat?d.repeat:5;if(0===n)return t(e);t(e.filter(function(e){return e.level!==T.ERROR&&e.level!==T.PROMISE_ERROR&&e.level!==T.AJAX_ERROR&&e.level!==T.SCRIPT_ERROR&&e.level!==T.IMAGE_ERROR&&e.level!==T.CSS_ERROR&&e.level!==T.MEDIA_ERROR||(p[e.msg]=p[e.msg]||0,p[e.msg]+=1,!(p[e.msg]>n))}))}),(l=this.lifeCycle.emit,f=this.config,function(e,t){var n=f.logCreated;if("function"!=typeof n)return l("beforeWrite",e),t(e);e=e.filter(function(e){return!1!==n(e)});return l("beforeWrite",e),t(e)}),(r=this,setTimeout(function(){var e=r.config.pvUrl,e=void 0===e?"":e;e&&r.send({url:e,type:L.PV},function(){},function(e){"403 forbidden"===e&&r.destroy()})},100),function(e,t){t(e)}),(i=u=a=!1,c=[],(s=this).lifeCycle.on("onConfigChange",function(){o&&clearTimeout(o),o=setTimeout(function(){var e;!i&&s.config&&(i=!0,(e=void 0===(e=s.config.whiteListUrl)?"":e)&&s.send({url:e,type:L.WHITE_LIST},function(e){u=!0;try{var t=e.data||JSON.parse(e),n=t.retcode,o=t.result,i=void 0===o?{}:o;if(0===n){if(a=i.is_in_white_list,s.isWhiteList=a,i.shutdown)return void s.destroy();0<=i.rate&&i.rate<=1&&(s.config.random=i.rate)}s.isWhiteList&&c.length?j(s)(c.splice(0),function(){}):!s.isWhiteList&&c.length&&(c.length=0);var r=s.config.onWhitelist;"function"==typeof r&&r(a)}catch(e){}},function(e){"403 forbidden"===e&&s.destroy(),u=!0}),i=!1)},s.config.uin?50:500)}),s.lifeCycle.on("destroy",function(){c.length=0}),function(e,t){a?t(e.concat(c.splice(0)).map(function(e){return _(e),e})):(e=e.filter(function(e){return e.level!==T.INFO&&e.level!==T.API_RESPONSE?(_(e),!0):(u||(c.push(e),200<=c.length&&(c.length=200)),!1)})).length&&t(e)}),function(e,t){var n=JSON.parse(JSON.stringify(e));h.lifeCycle.emit("beforeReport",n);var o=h.config.beforeReport;(e="function"==typeof o?e.filter(function(e){return!1!==o(e)}):e).length&&t(e)},j(this)]),this.eventPipeline=I([C(this,5),function(e){var t=e.map(function(e){return{name:e.name,ext1:e.ext1||h.config.ext1||"",ext2:e.ext2||h.config.ext2||"",ext3:e.ext3||h.config.ext3||""}});return h.send({url:h.config.eventUrl+"?payload="+encodeURIComponent(JSON.stringify(t)),type:L.EVENT,log:e},function(){},function(e){"403 forbidden"===e&&h.destroy()})}]),this.timeMap={},this.customTimePipeline=I([C(this,5),function(e){return h.send({url:h.config.customTimeUrl+"?payload="+encodeURIComponent(JSON.stringify({custom:e})),type:L.CUSTOM,log:e},function(){},function(e){"403 forbidden"===e&&h.destroy()})}]),this.config=(t=this.config,void 0===(e=e.hostUrl)&&(e="https://aegis.qq.com"),t.url=t.url||e+"/collect",t.offlineUrl=t.offlineUrl||e+"/offline",t.whiteListUrl=t.whiteListUrl||e+"/collect/whitelist",t.pvUrl=t.pvUrl||e+"/collect/pv",t.eventUrl=t.eventUrl||e+"/collect/events",t.speedUrl=t.speedUrl||e+"/speed",t.customTimeUrl=t.customTimeUrl||e+"/speed/custom",t.performanceUrl=t.performanceUrl||e+"/speed/performance",t.webVitalsUrl=t.webVitalsUrl||e+"/speed/webvitals",t),$.instances.push(this)}(Le=A=A||{})[Le.unknown=100]="unknown",Le[Le.wifi=1]="wifi",Le[Le.net2g=2]="net2g",Le[Le.net3g=3]="net3g",Le[Le.net4g=4]="net4g",Le[Le.net5g=5]="net5g",Le[Le.net6g=6]="net6g",(Pe=N=N||{})[Pe.android=1]="android",Pe[Pe.ios=2]="ios",Pe[Pe.windows=3]="windows",Pe[Pe.macos=4]="macos",Pe[Pe.linux=5]="linux",Pe[Pe.other=100]="other";function Q(e,t){return{name:e,value:void 0===t?-1:t,delta:0,entries:[],id:"v2-".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12)}}function K(e,t){try{if(PerformanceObserver.supportedEntryTypes.includes(e)){if("first-input"===e&&!("PerformanceEventTiming"in self))return;var n=new PerformanceObserver(function(e){return e.getEntries().map(t)});return n.observe({type:e,buffered:!0}),n}}catch(e){}}function Y(t,n){function o(e){"pagehide"!==e.type&&"hidden"!==document.visibilityState||(t(e),n&&(removeEventListener("visibilitychange",o,!0),removeEventListener("pagehide",o,!0)))}addEventListener("visibilitychange",o,!0),addEventListener("pagehide",o,!0)}function z(t,n,o){var i;return function(e){0<=n.value&&(e||o)&&(n.delta=n.value-(i||0),!n.delta&&void 0!==i||(i=n.value,t(n)))}}function Z(){return ve<0&&(ve=me(),ye(),ge(function(){setTimeout(function(){ve=me(),ye()},0)})),{get firstHiddenTime(){return ve}}}function ee(t,n){function e(e){"first-contentful-paint"===e.name&&(a&&a.disconnect(),e.startTime<i.firstHiddenTime&&(r.value=e.startTime,r.entries.push(e),o(!0)))}var o,i=Z(),r=Q("FCP"),s=performance.getEntriesByName&&performance.getEntriesByName("first-contentful-paint")[0],a=s?null:K("paint",e);(s||a)&&(o=z(t,r,n),s&&e(s),ge(function(e){r=Q("FCP"),o=z(t,r,n),requestAnimationFrame(function(){requestAnimationFrame(function(){r.value=performance.now()-e.timeStamp,o(!0)})})}))}function te(){var t;0<=se&&se<ae-Oe&&(t={entryType:"first-input",name:re.type,target:re.target,cancelable:re.cancelable,startTime:re.timeStamp,processingStart:re.timeStamp+se},ue.forEach(function(e){e(t)}),ue=[])}function ne(e){var t,n,o,i;function r(){Re(n,o),i()}function s(){i()}e.cancelable&&(t=(1e12<e.timeStamp?new Date:performance.now())-e.timeStamp,"pointerdown"==e.type?(n=t,o=e,i=function(){removeEventListener("pointerup",r,Ee),removeEventListener("pointercancel",s,Ee)},addEventListener("pointerup",r,Ee),addEventListener("pointercancel",s,Ee)):Re(t,e))}function oe(t){["mousedown","keydown","touchstart","pointerdown"].forEach(function(e){return t(e,ne,Ee)})}var ie,re,se,ae,ue,ce=new q({name:"device",onNewAegis:function(e){e.extendBean("platform",this.getPlatform()),e.extendBean("netType",A.unknown),this.refreshNetworkTypeToBean(e)},getPlatform:function(){var t={android:/\bAndroid\s*([^;]+)/,ios:/\b(iPad|iPhone|iPod)\b.*? OS ([\d_]+)/,windows:/\b(Windows NT)/,macos:/\b(Mac OS)/,linux:/\b(Linux)/i},e=Object.keys(t).find(function(e){return t[e].test(navigator.userAgent)});return e?N[e]:N.other},refreshNetworkTypeToBean:function(t){var n=this,e=t.config;e&&("function"==typeof e.getNetworkType?e.getNetworkType:le)(function(e){A[e]||(e=A.unknown),t.extendBean("netType",e),n.NetworkRefreshTimer=setTimeout(function(){n.refreshNetworkTypeToBean(t),clearTimeout(n.NetworkRefreshTimer)},1e4)})}}),le=function(e){var t="",n=navigator.userAgent.match(/NetType\/(\w+)/);n?t=n[1]:navigator.connection&&(t=navigator.connection.effectiveType||navigator.connection.type),e((t=t=t||"unknown",0<=(t=String(t).toLowerCase()).indexOf("4g")?A.net4g:0<=t.indexOf("wifi")?A.wifi:0<=t.indexOf("5g")?A.net5g:0<=t.indexOf("6g")?A.net6g:0<=t.indexOf("3g")?A.net3g:0<=t.indexOf("2g")?A.net2g:A.unknown))},fe=new q({name:"onError"}),de=fe=new q({name:"onError",onNewAegis:function(e){this.startListen(e)},startListen:function(e){var o=this,n=window.onerror;window.onerror=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];o.publishErrorLog({msg:(x(e[0])||"")+" @ ("+(x(e[1])||"")+":"+(e[2]||0)+":"+(e[3]||0)+")\n          \n"+x(e[4]||""),level:T.ERROR}),null==n||n.call.apply(n,function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;for(var o=Array(e),i=0,t=0;t<n;t++)for(var r=arguments[t],s=0,a=r.length;s<a;s++,i++)o[i]=r[s];return o}([window],e))};function t(e){e=e&&x(e.reason),o.publishErrorLog({msg:"PROMISE_ERROR: "+e,level:T.PROMISE_ERROR})}window.addEventListener("unhandledrejection",t);function i(e){if(e=(null==e?void 0:e.target)||(null==e?void 0:e.srcElement)){var t=e.src||e.href,e=e.tagName;if("string"==typeof t&&e){var n={msg:e+" load fail: "+t,level:T.INFO};switch(e.toLowerCase()){case"script":n.level=T.SCRIPT_ERROR;break;case"link":n.level=T.CSS_ERROR;break;case"img":if(-1<window.location.href.indexOf(t))return;n.level=T.IMAGE_ERROR;break;case"audio":case"video":n.level=T.MEDIA_ERROR;break;default:return}o.publishErrorLog(n)}}}window.document.addEventListener("error",i,!0),e.lifeCycle.on("destroy",function(){0===fe.countInstance()&&(window.document.removeEventListener("unhandledrejection",t),window.document.removeEventListener("error",i,!0))});var r=this,e={name:this.name,send:function(t,n){t.addEventListener("loadend",function(){var e="";this.aegisTimeout?e="timeout":this.status<=0?e="failed":400<=this.status&&(e="error"),e&&r.publishErrorLog({msg:"AJAX_ERROR: request "+e+"\n                      \nres status: "+this.status+"\n                      \nres duration: "+(Date.now()-t.aegisXhrStartTime)+"\n                      \nreq url: "+this.aegisUrl+"\n                      \nreq method: "+this.aegisMethod+"\n                      \nreq param: "+R(n)+"\n                      \nres data: "+(null===(e=(e=t).responseType&&"text"!==e.responseType?"":e.responseText)||void 0===e?void 0:e.slice(0,1e3)),level:T.AJAX_ERROR})}),t.addEventListener("timeout",function(){t.aegisTimeout=!0})}};this.hackXHROptions=e,f(this.hackXHROptions)},publishErrorLog:function(t){this.$walk(function(e){e.normalLogPipeline(t)})},destroy:function(){this.option.publishErrorLog=function(){},this.option.hackXHROptions&&h(this.option.hackXHROptions)}}),pe=(new q({name:"pagePerformance"}),1),he=new q({name:"pagePerformance",onNewAegis:function(o){var i=this;if(v())if(ie)this.publish(ie,o);else try{this.getFirstScreenTiming(o,function(e){var t,n=performance.timing;n&&(t=n.loadEventStart-n.domInteractive,ie={dnsLookup:n.domainLookupEnd-n.domainLookupStart,tcp:n.connectEnd-n.connectStart,ssl:0===n.secureConnectionStart?0:n.requestStart-n.secureConnectionStart,ttfb:n.responseStart-n.requestStart,contentDownload:n.responseEnd-n.responseStart,domParse:n.domInteractive-n.domLoading,resourceDownload:t=t<0?1070:t,firstScreenTiming:Math.floor(e)},i.publish(ie,o))})}catch(o){}},publish:function(e,t){var n,o=[];for(n in e)o.push(n+"="+e[n]);var i=this.$getConfig(t);if(i){var r=-1===t.config.performanceUrl.indexOf("?")?"?":"&";return"function"==typeof i.urlHandler?t.send({url:t.config.performanceUrl+r+o.join("&")+"&from="+(encodeURIComponent(i.urlHandler())||window.location.href),beanFilter:["from"],type:L.PERFORMANCE,log:e}):t.send({url:t.config.performanceUrl+r+o.join("&"),type:L.PERFORMANCE,log:e})}},getFirstScreenTiming:function(i,t){var n=["script","style","link","br"],r=[],s=this,a={},u=new MutationObserver(function(e){var t={roots:[],rootsDomNum:[],time:performance.now()};e.forEach(function(e){e&&e.addedNodes&&e.addedNodes.forEach&&e.addedNodes.forEach(function(e){1===e.nodeType&&(e.hasAttribute("AEGIS-FIRST-SCREEN-TIMING")||e.querySelector("[AEGIS-FIRST-SCREEN-TIMING]"))?(Object.prototype.hasOwnProperty.apply(a,[t.time])||(a[t.time]=[]),a[t.time].push(e)):1!==e.nodeType||-1!==n.indexOf(e.nodeName.toLocaleLowerCase())||s.isEleInArray(e,t.roots)||e.hasAttribute("AEGIS-IGNORE-FIRST-SCREEN-TIMING")||(t.roots.push(e),t.rootsDomNum.push(s.walkAndCount(e)||0))})}),t.roots.length&&r.push(t)});u.observe(document,{childList:!0,subtree:!0});var c=function(){var n=0,o=0,e=Object.keys(a).filter(function(e){return a[+e].find(function(e){return s.isInFirstScreen(e)})});e.length?(o=Math.max.apply(null,e),i.firstScreenInfo={element:null===(e=a[o])||void 0===e?void 0:e[0],timing:o,markDoms:a}):r.forEach(function(e){for(var t=0;t<e.roots.length;t++)e.rootsDomNum[t]>n&&s.isInFirstScreen(e.roots[t])&&(n=e.rootsDomNum[t],o=e.time,i.firstScreenInfo={element:e.roots[t],timing:o})}),!o&&pe?setTimeout(function(){return c()},3e3):(u.disconnect(),null==t||t(o)),--pe};setTimeout(function(){return c()},3e3)},isEleInArray:function(e,t){return!(!e||e===document.documentElement)&&(-1!==t.indexOf(e)||this.isEleInArray(e.parentElement,t))},isInFirstScreen:function(e){if(!e||"function"!=typeof e.getBoundingClientRect)return!1;var t=e.getBoundingClientRect(),n=window.innerHeight,e=window.innerWidth;return 0<=t.left&&t.left<e&&0<=t.top&&t.top<n&&0<t.width&&0<t.height},walkAndCount:function(e){var t=0;if(e&&1===e.nodeType){t+=1;var n=e.children;if(null!=n&&n.length)for(var o=0;o<n.length;o++)t+=this.walkAndCount(n[o])}return t}}),ge=function(t){addEventListener("pageshow",function(e){e.persisted&&t(e)},!0)},ve=-1,me=function(){return"hidden"===document.visibilityState?0:1/0},ye=function(){Y(function(e){e=e.timeStamp;ve=e},!0)},we=!1,be=-1,Ee={passive:!0,capture:!0},Oe=new Date,Re=function(e,t){re||(re=t,se=e,ae=new Date,oe(removeEventListener),te())},Te=new Set,Le=(new q({name:"webVitals"}),new q({name:"webVitals",onNewAegis:function(e){var t,n,o,i,r,s,a,u,c,l,f,d;if(v()&&"function"==typeof window.PerformanceObserver&&"function"==typeof(t=window.Set)&&/native code/.test(t.toString()))try{ee(this.publish.bind(this,e)),a=this.publish.bind(this,e),l=Z(),f=Q("LCP"),(d=K("largest-contentful-paint",h))&&(u=z(a,f,void 0),c=function(){Te.has(f.id)||(d.takeRecords().map(h),d.disconnect(),Te.add(f.id),u(!0))},["keydown","click"].forEach(function(e){addEventListener(e,c,{once:!0,capture:!0})}),Y(c,!0),ge(function(e){f=Q("LCP"),u=z(a,f,void 0),requestAnimationFrame(function(){requestAnimationFrame(function(){f.value=performance.now()-e.timeStamp,Te.add(f.id),u(!0)})})})),n=this.publish.bind(this,e),o=Z(),i=Q("FID"),r=K("first-input",p),s=z(n,i,void 0),r&&Y(function(){r.takeRecords().map(p),r.disconnect()},!0),r&&ge(function(){i=Q("FID"),s=z(n,i,void 0),ue=[],se=-1,re=null,oe(addEventListener),ue.push(p),te()}),function(t){we||(ee(function(e){be=e.value}),we=!0);function e(e){-1<be&&t(e)}function n(e){var t,n;e.hadRecentInput||(t=s[0],n=s[s.length-1],r&&e.startTime-n.startTime<1e3&&e.startTime-t.startTime<5e3?(r+=e.value,s.push(e)):(r=e.value,s=[e]),r>i.value&&(i.value=r,i.entries=s,o()))}var o,i=Q("CLS",0),r=0,s=[],a=K("layout-shift",n);a&&(o=z(e,i,void 0),Y(function(){a.takeRecords().map(n),o(!0)}),ge(function(){be=-1,i=Q("CLS",r=0),o=z(e,i,void 0)}))}(this.publish.bind(this,e))}catch(e){}function p(e){e.startTime<o.firstHiddenTime&&(i.value=e.processingStart-e.startTime,i.entries.push(e),s(!0))}function h(e){var t=e.startTime;t<l.firstHiddenTime&&(f.value=t,f.entries.push(e)),u()}},publish:function(e,t){var n,o={FCP:-1,LCP:-1,FID:-1,CLS:-1},i=t.name,r=t.value,s=[];for(n in o)s.push(n+"="+(n===i?r:o[n]));var a=-1===e.config.performanceUrl.indexOf("?")?"?":"&";setTimeout(function(){e.send({url:e.config.webVitalsUrl+a+s.join("&"),type:L.VITALS,log:t})})},destroy:function(){this.option.publish=function(){}}})),xe=function(t){if(t.payload){var n={};return Object.keys(t).forEach(function(e){"payload"!==e&&(n[e]=t[e])}),n}return t};Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(null==e)throw new TypeError("Cannot convert first argument to object");for(var t=Object(e),n=1;n<arguments.length;n++)if(null!=(o=arguments[n]))for(var o=Object(o),i=Object.keys(Object(o)),r=0,s=i.length;r<s;r++){var a=i[r],u=Object.getOwnPropertyDescriptor(o,a);null!=u&&u.enumerable&&(t[a]=o[a])}return t}}),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{configurable:!0,writable:!0,value:function(e){if(null===this)throw new TypeError('"this" is null or not defined');var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var o=arguments[1],i=0;i<n;){var r=t[i];if(e.call(o,r,i,t))return r;i+=1}}}),String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{value:function(e,t){return this.substring(t=!t||t<0?0:+t,t+e.length)===e}});var Se,Ce,Pe,Ie=0,Ae=(n(Ce=ke,Pe=Se=F),Ce.prototype=null===Pe?Object.create(Pe):(_e.prototype=Pe.prototype,new _e),ke.prototype.getBean=function(t){var n=this;return void 0===t&&(t=[]),""+Object.getOwnPropertyNames(this.bean).filter(function(e){return-1===t.indexOf(e)}).map(function(e){return e+"="+n.bean[e]}).join("&")},ke.prototype.request=function(e,t,n){var o=this;if(e&&"string"==typeof e.url&&""!==e.url&&this.bean.id)if(this.requesting)this.requestQueue.push({options:e,success:t,fail:n});else{this.requesting=!0;var i=e.url;!1!==e.addBean&&(i=i+(-1===i.indexOf("?")?"?":"&")+this.getBean(e.beanFilter)),e.url=i;var r=e.method||"get",i=this.config.onBeforeRequest;if(!(e=i?i(e,this):e))return console.log("Sending request blocked");if(!e.url)return console.warn("Please handle the parameters reasonably, options.url is necessary");var s=new XMLHttpRequest;s.sendByAegis=!0,s.addEventListener("readystatechange",function(){var e;4===s.readyState&&(o.requesting=!1,o.requestQueue&&((e=o.requestQueue.shift())&&o.request(e.options,e.success,e.fail),400<=s.status||0===s.status?null==n||n(s.response):null==t||t(s.response)))}),"get"===r.toLocaleLowerCase()?(s.open("get",function(e,n){if("string"!=typeof e)return"";if("object"==typeof n&&n){var t=Object.getOwnPropertyNames(n).map(function(e){var t=n[e];return e+"="+("string"==typeof t?encodeURIComponent(t):encodeURIComponent(JSON.stringify(t)))}).join("&").replace(/eval/gi,"evaI");return e+(-1===e.indexOf("?")?"?":"&")+t}return e}(e.url,e.data)),s.send()):(s.open("post",e.url),e.contentType&&s.setRequestHeader("Content-Type",e.contentType),"string"==typeof e.data&&(e.data=e.data.replace(/eval/gi,"evaI")),s.send(e.data))}},ke.useAsyncPlugin=function(s,e){var t=(e=void 0===e?{}:e).exportsConstructor,a=void 0===t?"aegis-plugin-"+Ie:t,t=e.onAegisInit,u=void 0===t?function(){}:t,e=e.onAegisInitAndPluginLoaded,c=void 0===e?function(){}:e;if(Ie+=1,"string"!=typeof s)throw new TypeError("useAsyncPlugin first param must be string");if("function"!=typeof u||"function"!=typeof c)throw new TypeError("onAegisInit and onAegisInitAndPluginLoaded must be function");this.use(new q({name:"asyncPlugin",onNewAegis:function(t){try{u(t),ke.asyncPlugin[s]?c(t,window[ke.asyncPlugin[s]]):(e=s,n=a,o=function(e){e||(ke.asyncPlugin[s]=a,e=window[a],c(t,e))},i=document.createElement("script"),r=document.head,"function"==typeof n&&(o=n,n=""),i.src=e,i.setAttribute("name",n),i.name=n,i.setAttribute("crossorigin","anonymous"),i.crossorigin="anonymous",i.defer=!0,i.hasLoaded=!1,i.onreadystatechange=function(){i.hasLoaded||i.readyState&&"loaded"!==i.readyState&&"complete"!==i.readyState||(i.hasLoaded=!0,"function"==typeof o&&o(!1),setTimeout(function(){r.contains(i)&&r.removeChild(i)}))},i.onload=i.onreadystatechange,i.onerror=function(){"function"==typeof o&&o(!0),setTimeout(function(){r.contains(i)&&r.removeChild(i)})},"complete"===document.readyState?r.appendChild(i):window.addEventListener("load",function(){r.appendChild(i)}))}catch(t){console.log("error on below is caused by "+s+" "),console.error(t)}var e,n,o,i,r}}))},ke.prototype.uploadLogs=function(e,t){this.lifeCycle.emit("uploadLogs",e=void 0===e?{}:e,t=void 0===t?{}:t)},ke.__version__="1.34.49",ke.sessionID="session-"+Date.now(),ke.asyncPlugin={},ke.urls={aegisCollect:"https://aegis.qq.com/collect",flog:"https://cdn-go.cn/vasdev/web_webpersistance_v2/v1.8.1/flog.core.min.js",shadowLog:""},ke),Ne=new q({name:"offlineLog"}),F=Ne=new q({name:"offlineLog",onNewAegis:function(e){var t=Ae.urls.flog,h=e.config,g=[],v=null,m=null,y=function(e){m=e},w=function(e){g=g.concat(e)},b=function(e,t){v={conds:e=void 0===e?{}:e,params:t=void 0===t?{}:t}};Ae.useAsyncPlugin(t,{exportsConstructor:"Flog",onAegisInit:function(e){e.lifeCycle.on("beforeWrite",w),e.lifeCycle.on("uploadLogs",b),e.lifeCycle.on("onConfigChange",y)},onAegisInitAndPluginLoaded:function(o,e){var t,n,i,r,s,a=h.dbConfig,u=void 0===a?{}:a,c=h.url,l=void 0===c?Ae.urls.aegisCollect:c,f=h.offlineLogExp,d=void 0===f?3:f,a=h.id,c=h.uin;null===(f=o.lifeCycle)||void 0===f||f.remove("beforeWrite",w),null===(f=o.lifeCycle)||void 0===f||f.remove("uploadLogs",b),null===(f=o.lifeCycle)||void 0===f||f.remove("onConfigChange",y);u=Object.assign({lookupUrl:l+"/offlineAuto?id="+a,preservedDay:d,id:a,uin:c,aid:(null===(c=o.bean)||void 0===c?void 0:c.aid)||"",beforeRequest:o.config.beforeRequest,afterRequest:o.config.afterRequest},u,{sessionId:Ae.sessionID});try{var p=new e(u);g.forEach(function(e){p.add(E(E({},e),{level:e.level===T.INFO_ALL?T.INFO:e.level}))}),null===(t=o.lifeCycle)||void 0===t||t.on("beforeWrite",function(e){(e=void 0===e?[]:e).forEach(function(e){p.add(E(E({},e),{level:e.level===T.INFO_ALL?T.INFO:e.level}))})}),null===(n=o.lifeCycle)||void 0===n||n.on("uploadLogs",function(e,t){var n;void 0===e&&(e={}),void 0===t&&(t={}),p.uploadLogs(Object.assign({id:h.id,uin:h.uin,aid:null===(n=o.bean)||void 0===n?void 0:n.aid},e),t)}),null===(i=o.lifeCycle)||void 0===i||i.on("onConfigChange",function(e){p.setConfig(e)}),null===(r=o.lifeCycle)||void 0===r||r.on("destroy",function(){0===Ne.countInstance()&&(g.length=0,"function"==typeof((v=null)==p?void 0:p.destroy)&&p.destroy())}),p.on("PERREVENT",function(e){o.send({type:L.OFFLINE,data:O({msg:x(e),level:T.INFO}),contentType:"application/x-www-form-urlencoded",method:"post",addBean:!1,url:h.url+"?id=893&sessionId="+Ae.sessionID+"&uin="+h.uin+"&from="+h.id+"&count=1&version=1.34.49",log:L.OFFLINE})}),m&&(p.setConfig(m),m=null),v&&(null===(s=o.lifeCycle)||void 0===s||s.emit("uploadLogs",v.conds,v.params),v=null),o.flog=p}catch(o){console.log(o)}}})}}),Pe=(new q({name:"spa"}),new q({name:"spa",init:function(){history.pushState=this.wr("pushState")||history.pushState,history.replaceState=this.wr("replaceState")||history.replaceState;var e=(null===(e=location.href)||void 0===e?void 0:e.split("?"))[0];this.$fireUrl=e,this.sendPv=this.sendPv.bind(this),this.onPageChange()},onPageChange:function(){window.addEventListener("replaceState",this.sendPv),window.addEventListener("pushState",this.sendPv),window.addEventListener("popstate",this.sendPv)},wr:function(n){var o=history[n];return"function"==typeof o&&!history.__hasWrittenByTamSpa&&(Object.defineProperty(history,"__hasWrittenByTamSpa",{value:!0,enumerable:!1}),function(){var e=o.apply(this,arguments),t=null;return"function"==typeof Event?t=new Event(n):(t=document.createEvent("HTMLEvents")).initEvent(n,!1,!0),window.dispatchEvent(t),e})},sendPv:function(){var n=this;setTimeout(function(){var t=location.href,e=(null===(e=location.href)||void 0===e?void 0:e.split("?"))[0];e&&e!==n.$fireUrl&&(n.$walk(function(e){e.send({url:e.config.pvUrl+"?from="+encodeURIComponent(t),beanFilter:["from"],type:L.WHITE_LIST})}),n.$fireUrl=e)},0)},destroy:function(){window.removeEventListener("replaceState",this.option.sendPv),window.removeEventListener("pushState",this.option.sendPv),window.removeEventListener("popstate",this.option.sendPv)}}));function ke(e){var t,n,o,i,r,s=Se.call(this,e)||this;s.requestQueue=[],s.requesting=!1,s.speedLogPipeline=I([(i=s.config,r={},function(e,t){var n,o;i.speedSample?(o="object"==typeof i.repeat?i.repeat:{repeat:i.repeat},n=+o.speed||+o.repeat||5,Array.isArray(e)?(o=e.filter(function(e){var t=!r[e.url]||r[e.url]<n;return r[e.url]=1+~~r[e.url],t})).length&&t(o):(!r[e.url]||r[e.url]<n)&&(r[e.url]=1+~~r[e.url],t(e))):t(e)}),C(s),(o=s,function(t,n){le(function(e){o.extendBean("netType",e),n(t)})}),function(e,t){s.lifeCycle.emit("beforeReportSpeed",e);var n=s.config.beforeReportSpeed;if((e="function"==typeof n?e.filter(function(e){var t=!1!==n(e);return"fetch"===e.type&&void 0===e.ret&&e.payload&&(e.ret=b(e.payload.data.response,s.config.api)),t}):e).length)return t(e)},function(e){return s.send({type:L.SPEED,url:""+s.config.speedUrl,method:"post",data:(t=e,n=s.bean,i={fetch:[],static:[]},r=new FormData,Array.isArray(t)?t.forEach(function(e){var t=xe(e);i[e.type].push(t)}):(o=xe(t),i[t.type].push(o)),r.append("payload",JSON.stringify(E({duration:i},n))),r),log:e});var t,n,o,i,r}]),e.asyncPlugin=!0;try{"undefined"!=typeof document&&(e.uin=e.uin||(null!==(t=document.cookie.match(/\buin=\D+(\d*)/))&&void 0!==t?t:[])[1]||(null!==(n=document.cookie.match(/\bilive_uin=\D*(\d+)/))&&void 0!==n?n:[])[1]||""),s.init(e),s.extendBean("sessionId",ke.sessionID),s.extendBean("from",encodeURIComponent(e.pageUrl||location.href)),"undefined"!=typeof document&&s.extendBean("referer",encodeURIComponent(document.referrer||"")),e.ext1&&s.extendBean("ext1",e.ext1),e.ext2&&s.extendBean("ext2",e.ext2),e.ext3&&s.extendBean("ext3",e.ext3)}catch(e){console.warn(e),console.log("%cThe above error occurred in the process of initializing Aegis, which will affect your normal use of Aegis.\nIt is recommended that you contact us for feedback and thank you for your support.","color: red"),s.sendSDKError(e)}return s}function _e(){this.constructor=Ce}return new q({name:"ie"}),Ae.use(de),Ae.use(G),Ae.use(M),Ae.use(he),Ae.use(Le),Ae.use(H),Ae.use(ce),Ae.use(F),Ae.use(Pe),Ae});
